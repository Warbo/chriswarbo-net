#! /usr/bin/env nix-shell
#! nix-shell -i bash

if command -v ts > /dev/null && ts | grep queued | grep render > /dev/null
then
  echo "Another render is queued, deferring to that"
  exit 0
fi
  
printf "Waiting for rendering lock..." 1>&2
(
flock -x 200
printf "lock aquired.\n" 1>&2

make -j2 -f Makefile "$@"

) 200>/tmp/blog.lock

