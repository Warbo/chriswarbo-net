#!/usr/bin/env bash

mkdir -p "$out/essays"

echo "Creating new essays/ redirects" 1>&2
find "$projects" -type f | while read -r PRJ_FILE
do
    ESSAY_FILE=$(echo "$PRJ_FILE" |
                      sed -e "s@$projects/@$out/essays/@g")

       PRJ_URL=$(echo "$PRJ_FILE" |
                      sed -e "s@$projects/@/projects/@g")

    ESSAY_DIR=$(dirname "$ESSAY_FILE")
    mkdir -p "$ESSAY_DIR"

    mkRedirectTo "$PRJ_URL" > "$ESSAY_FILE"
done

mkRedirectTo "projects.html" > "$out/essays.html"

# Old links
for P in "$projects"/*
do
    [[ -d "$P" ]] || continue
    NAME=$(basename "$P")

    mkdir -p "$out/$NAME"
    mkRedirectTo "/projects/$NAME/index.html" > "$out/$NAME/index.html"
done
