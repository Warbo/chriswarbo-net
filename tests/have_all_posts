#! /usr/bin/env nix-shell
#! nix-shell -i bash -p bash xidel

LINKS=$(xidel - -q --extract "//a/@href" < rendered/blog.html)

while read -r SOURCE
do
    [[ "x$SOURCE" = "xblog/index.html" ]] && continue

    NAME=$(basename "$SOURCE" | rev | cut -d '.' -f 2- | rev)
    DEST="/blog/$NAME.html"
    if [[ ! -e "rendered$DEST" ]]
    then
        echo "Can't find rendered$DEST" >> /dev/stderr
        exit 1
    fi
    if ! echo "$LINKS" | grep "$NAME" > /dev/null
    then
        echo "blog/$NAME.html doesn't appear in blog.html" >> /dev/stderr
        exit 1
    fi
done < <(find blog -type f)

exit 0
